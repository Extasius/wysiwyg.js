!function(e,t,n){"use strict";var r=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var o=this,i=arguments;r=setTimeout(function(){r=null,e.apply(o,i)},t)}},o=function(e,t,n,r){e.addEventListener(t,n,!!r)},i=function(e,t,n,r){e.removeEventListener(t,n,!!r)},a=function(e){e.preventDefault(),e.stopPropagation()},l=function(e,t,n){for(var r=n?t.parentNode:t;r;){if(r===e)return!0;r=r.parentNode}return!1},u=function(e){var t=e.nodeName;return"IMG"==t||"PICTURE"==t||"SVG"==t||"VIDEO"==t||"AUDIO"==t||"IFRAME"==t||"MAP"==t||"OBJECT"==t||"EMBED"==t},c=function(t){var n=e.getSelection();return n.rangeCount>0?n.getRangeAt(0):null},f=function(t,n){if(n){var r=e.getSelection();r.removeAllRanges(),r.addRange(n)}},s=function(){var t=e.getSelection();if(!t.rangeCount)return!1;var n=t.getRangeAt(0).cloneRange(),r=n.getBoundingClientRect();if(r&&r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)};for(var o=n.getClientRects?n.getClientRects():[],i=0;i<o.length;++i){var r=o[i];if(r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)}}return!1},p=function(t){return!!e.getSelection().isCollapsed},d=function(n){var r=e.getSelection();if(!r.rangeCount)return[];for(var o=[],i=0;i<r.rangeCount;++i)for(var a=r.getRangeAt(i),u=a.startContainer,c=a.endContainer;u;){if(u!=n){var f=!1;if(r.containsNode)f=r.containsNode(u,!0);else{var s=t.createRange();s.selectNodeContents(u);for(var i=0;i<r.rangeCount;++i){var a=r.getRangeAt(i);if(a.compareBoundaryPoints(a.END_TO_START,s)>=0&&a.compareBoundaryPoints(a.START_TO_END,s)<=0){f=!0;break}}}f&&o.push(u)}u=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}(u,u==c?c:n)}return 0==o.length&&l(n,r.focusNode)&&r.focusNode!=n&&o.push(r.focusNode),o},h=function(){var t=e.getSelection();if(!t.isCollapsed)try{t.collapseToEnd()}catch(e){}},v=function(t,n,r){var o=e.getSelection();if(o.modify){for(var i=0;i<n;++i)o.modify("extend","backward","character");for(var i=0;i<r;++i)o.modify("extend","forward","character")}else{var a=o.getRangeAt(0);a.setStart(a.startContainer,a.startOffset-n),a.setEnd(a.endContainer,a.endOffset+r),o.removeAllRanges(),o.addRange(a)}},g=function(n){if(p())return null;var r=e.getSelection();if(r.rangeCount){for(var o=t.createElement("div"),i=r.rangeCount,a=0;a<i;++a){var l=r.getRangeAt(a).cloneContents();o.appendChild(l)}return o.innerHTML}return null},m=function(n,r){var o=e.getSelection();if(l(n,o.anchorNode)&&l(n,o.focusNode))return!0;if(!r)return!1;var i=t.createRange();return i.selectNodeContents(n),i.collapse(!1),o.removeAllRanges(),o.addRange(i),!0},b=function(n,r){var o=e.getSelection();if(o.getRangeAt&&o.rangeCount){var i=o.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var u,c,f=t.createDocumentFragment();u=a.firstChild;)c=f.appendChild(u);l(n,i.commonAncestorContainer)?(i.deleteContents(),i.insertNode(f)):n.appendChild(f),c&&(i=i.cloneRange(),i.setStartAfter(c),i.collapse(!0),o.removeAllRanges(),o.addRange(i))}};e.wysiwyg=function(n,C){var E,y=C.toolbar,T=C.buttons,k=C.selectionbuttons,S=C.suggester,L=C.interceptenter,w=!!C.hijackmenu,R="string"==typeof n?t.querySelector(n):n,M=R.querySelector("textarea"),N={},H="top"==y,I="bottom"==y,A=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},P=function(e,t){e.classList&&e.classList.remove(t)},x=R.querySelector("[contenteditable=true]");if(!x){x=t.createElement("div"),x.setAttribute("contentEditable","true");var D=M.placeholder;D&&x.setAttribute("placeholder",D),R.insertBefore(x,R.firstChild)}var B=null,O=function(){B&&clearTimeout(B),B=null,A(R,"focus")},W=function(){B||t.activeElement==x||(B=setTimeout(function(){B=null,P(R,"focus")},50))};o(x,"focus",O),o(x,"blur",W),M&&M.form&&o(M.form,"reset",W);var F,_=function(n,r){var i=t.createElement("input");i.placeholder="www.example.com",r&&(i.value=r.href),i.style.width="20em",i.style.maxWidth=parseInt(2*R.offsetWidth/3)+"px",i.autofocus=!0,r&&o(i,"input",function(e){var t=i.value.trim();t&&(r.href=t)}),o(i,"keypress",function(e){if(13==(e.which||e.keyCode)){var t=i.value.trim();if(r);else if(t){var n=t;if(/^[a-z0-9]+:\/\//.test(t)||(n="http://"+t),E.getSelectedHTML())E.insertLink(n);else{var o=function(e){return e.replace(/[&<>"]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e})};E.insertHTML('<a href="'+o(n)+'">'+o(t)+"</a>")}}E.closePopup().collapseSelection(),x.focus()}}),n.appendChild(i),e.setTimeout(function(){i.focus(),O()},1)},q=function(e,n){var r=t.createElement("table");r.style.borderCollapse="collapse";for(var i=1;i<15;++i){for(var a=t.createElement("tr"),l=0;l<25;++l){var u;if(24==l){var c=Math.floor(255/13*(14-i)).toString(16),f=(c.length<2?"0":"")+c;u="#"+f+f+f}else{var s=l/24,p=i<=8?i/8:1,d=i>8?(16-i)/8:1;u=function(e,t,n){var r,o,i,a,l,u,c,f;switch(a=Math.floor(6*e),l=6*e-a,u=n*(1-t),c=n*(1-l*t),f=n*(1-(1-l)*t),a%6){case 0:r=n,o=f,i=u;break;case 1:r=c,o=n,i=u;break;case 2:r=u,o=n,i=f;break;case 3:r=u,o=c,i=n;break;case 4:r=f,o=u,i=n;break;case 5:r=n,o=u,i=c}var s=Math.floor(255*r).toString(16),p=Math.floor(255*o).toString(16),d=Math.floor(255*i).toString(16);return"#"+(s.length<2?"0":"")+s+(p.length<2?"0":"")+p+(d.length<2?"0":"")+d}(s,p,d)}var h=t.createElement("td");h.style.width="0.5em",h.style.height="0.5em",h.style.cursor="pointer",h.style.backgroundColor=u,h.title=u,h.style.userSelect="none",o(h,"click",function(e){var t=this.title;n?E.forecolor(t).closePopup().collapseSelection():E.highlight(t).closePopup().collapseSelection()}),a.appendChild(h)}r.appendChild(a)}e.appendChild(r)},X=function(n,r,o){for(var i=R.offsetParent,a=0,l=0,u=!1,c=0,f=0,s=!1,p=!1;i;){c+=i.offsetLeft,f+=i.offsetTop;var d=getComputedStyle(i);"static"!=d.position?u=!0:u||(a+=i.offsetLeft,l+=i.offsetTop),"fixed"==d.position&&(s=!0),"visible"!=d.overflow&&(p=!0),i=i.offsetParent}var h=R.offsetParent||t.body;h.appendChild(n),r+=a+R.offsetLeft,o+=l+R.offsetTop;var v=n.offsetWidth;if(s||p){var g=h.offsetWidth;r+v>g-1&&(r=g-v-1),r<1&&(r=1)}var m=n.offsetHeight;if(s||p){var b=h.offsetHeight;o+m>b-1&&(o=b-m-1),o<1&&(o=1)}var C=e.innerWidth,E=s?0:t.documentElement.scrollLeft;c+r+v>C+E-2&&(r=C+E-c-v-2),c+r<E+1&&(r=E-c+1);var y=e.innerHeight,T=s?0:t.documentElement.scrollTop;f+o+m>y+T-2&&(o=y+T-f-m-2),f+o<T+1&&(o=T-f+1),n.style.left=parseInt(r)+"px",n.style.top=parseInt(o)+"px"},z=function(){var e=E.openPopup();for(A(e,"wysiwyg-popup");e.firstChild;)e.removeChild(e.firstChild);return e},Y=function(e,t,n){var r=z();t(r,n);var o=R.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.left-o.left+parseInt(e.offsetWidth/2)-parseInt(r.offsetWidth/2),l=i.top-o.top;H?l+=e.offsetHeight:l-=r.offsetHeight,X(r,a,l)},K=function(e,t){var n=R.getBoundingClientRect(),r=x.getBoundingClientRect(),o=t.left+parseInt(t.width/2)-parseInt(e.offsetWidth/2)+r.left-n.left,i=t.top+t.height+r.top-n.top;X(e,o,i)},U=function(e,t,n){var r=z();t(r,n),K(r,e)},V=null,G=null,j=function(e,n,r,i){r.forEach(function(r){if(r.html)if("string"==typeof r.html){var l=t.implementation.createHTMLDocument("");l.body.innerHTML=r.html;for(var u=l.body.firstChild;null!==u;u=u.nextSibling)e.appendChild(u),o(u,"focus",O),o(u,"blur",W)}else{var c=r.html;e.appendChild(c),o(c,"focus",O),o(c,"blur",W)}else{var c=t.createElement("a");c.href="#",c.innerHTML=r.icon,r.title&&(c.title=r.title),o(c,"focus",O),o(c,"blur",W);var f=null;"click"in r?f=function(){r.click(E,c)}:"popup"in r?f=function(){var e=function(e){r.popup(E,e,c)};n?U(n,e):Y(c,e)}:"browse"in r||"dataurl"in r?f=function(){E.closePopup().collapseSelection();var e=t.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",o(e,"change",function(t){var o="dataurl"in r;if(t.target.files)for(var i=n.target.files,l=0;l<i.length;++l){var u=i[l];if("browse"in r)r.browse(E,e,u,c);else if(u.size<16777216){var f=new FileReader;f.onloadend=function(e){r.dataurl(E,u.type,e.target.result,c)},f.readAsDataURL(u)}}else o=!0;o&&e.parentNode.removeChild(e),a(t)}),R.appendChild(e);var n=t.createEvent("MouseEvents");n.initEvent("click",!0,!1),e.dispatchEvent(n)}:"default"in r&&(f=function(){switch(r.default){case"link":n?U(n,_,G):Y(c,_,G);break;case"bold":E.bold();break;case"italic":E.italic();break;case"underline":E.underline();break;case"strikethrough":E.strikethrough();break;case"forecolor":n?U(n,q,!0):Y(c,q,!0);break;case"highlight":n?U(n,q,!1):Y(c,q,!1);break;case"subscript":E.subscript();break;case"superscript":E.superscript();break;case"removeformat":E.removeFormat().closePopup().collapseSelection()}}),c.onclick=function(e){f&&f(),a(e)},e.appendChild(c),"hotkey"in r&&f&&i&&(i[r.hotkey.toLowerCase()]=f)}})},J=null,$=1,Q=null,Z=function(e){e&&E.expandSelection(J.length,0).insertHTML(e),J=null,Q=null,$+=1,E.closePopup()},ee=function(e,t,n,r,o,i){return 13!=e||!Q||(Z(Q),!1)},te=function(){if(J){var e=$;S(J,function(n){if(V&&e==$){if(Q=null,!n)return void Z();U(V,function(e){n.forEach(function(n){var r=t.createElement("div");A(r,"suggestion"),r.innerHTML=n.label,r.style.cursor="pointer",o(r,"click",function(e){Z(n.insert),a(e)}),e.appendChild(r),null===Q&&(Q=n.insert)})})}})||Z()}},ne=r(te,100,!0),re=function(e,t,n,r,o,i){switch(e){case 8:if(J&&(J=J.slice(0,-1)),J)break;case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return Z(),!0;default:J||(J=""),J+=t}return ne(),!0},oe=function(e,t,n,r,o,i){if(S)return ee(e);if(L&&13==e&&!n&&!r&&!o&&!i&&(E.sync().closePopup(),L()))return!1;if(t&&!n&&!r&&o&&!i){var a=t.toLowerCase();if(!N[a])return;return N[a](),!1}},ie=function(e,t,n,r,o,i){if(S)return re(e,t)},ae=function(e,n,r,o){if(V=e?n||V:null,G=null,!n)return void Z();if(e){if(null!==J){var i=E.activePopup();return void(i&&K(i,n))}}else Z();for(var a=0;a<r.length;++a){var l=r[a],c=l.closest||function(e){for(var t=this;t;){var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;if(n&&n.call(t,e))return t;t=t.parentElement}return null};if(G=c.call(l,"a"))break}var f=!0;if(o||(k?e?f=!1:r.forEach(function(e){u(e)&&(f=!1)}):f=!1),!f)return void Z();U(n,function(e){var r=t.createElement("div");A(r,"toolbar"),e.appendChild(r),j(r,n,k)})},le=function(){O()},ue=function(){Z(),W()},ce=null,fe=null;if(M){!x.innerHTML&&M.value&&(x.innerHTML=M.value);var se=x.innerHTML;ce=function(){var e=x.innerHTML;e.match(/^<br[\/ ]*>$/i)&&(x.innerHTML="",e=""),e!=se&&(M.value=e,se=e)},o(x,"focus",function(){var e=t.createEvent("Event");e.initEvent("focus",!1,!1),M.dispatchEvent(e)}),o(x,"blur",function(){ce();var e=t.createEvent("Event");e.initEvent("blur",!1,!1),M.dispatchEvent(e)}),fe=r(ce,250,!0),o(x,"input",fe),o(x,"propertychange",fe),o(x,"textInput",fe),o(x,"paste",fe),o(x,"cut",fe),o(x,"drop",fe);new MutationObserver(fe).observe(x,{attributes:!0,childList:!0,characterData:!0,subtree:!0});var pe=M.form;pe&&o(pe,"reset",function(){x.innerHTML="",fe(),F(!0)})}var de=null,he=null;if(ae){he=r(function(e,t,n){var r=p(),o=d(x),i=null===e||null===t?null:{left:e,top:t,width:0,height:0},a=s();if(a&&(i=a),i){var l=x.getBoundingClientRect();i.left-=parseInt(l.left),i.top-=parseInt(l.top),i.left<0&&(i.left=0),i.top<0&&(i.top=0),i.width>x.offsetWidth&&(i.width=x.offsetWidth),i.height>x.offsetHeight&&(i.height=x.offsetHeight)}else if(o.length)for(var u=0;u<o.length;++u){var c=o[u];if(c.nodeType==Node.ELEMENT_NODE){i={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}}ae(r,i,o,n)},1)}var ve=null,ge=function(e){var t=e.target||e.srcElement;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),l(ve,t)||be()},me=function(){if(ve)return ve;o(e,"mousedown",ge,!0),ve=t.createElement("DIV");var n=x.parentNode,r=x.nextSibling;return r?n.insertBefore(ve,r):n.appendChild(ve),le&&le(),ve},be=function(){ve&&(ve.parentNode.removeChild(ve),ve=null,i(e,"mousedown",ge,!0),ue&&ue())},Ce=function(e,t){var n=e.which||e.keyCode,r=String.fromCharCode(n||e.charCode),o=e.shiftKey||!1,i=e.altKey||!1,l=e.ctrlKey||!1,u=e.metaKey||!1;if(1==t?oe&&!1===oe(n,r,o,i,l,u)&&a(e):2==t&&ie&&!1===ie(n,r)&&a(e),2==t&&(de=null),2!=t&&3!=t||he&&he(null,null,!1),2==t&&fe)switch(n){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:fe()}};o(x,"keydown",function(e){Ce(e,1)}),o(x,"keypress",function(e){Ce(e,2)}),o(x,"keyup",function(e){Ce(e,3)});var Ee=function(t,n){var r=null,o=null;t.clientX&&t.clientY?(r=t.clientX,o=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,o=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),i(e,"mouseup",Ee),de=null,!w&&n||he&&he(r,o,n)},ye=null;o(x,"mousedown",function(t){i(e,"mouseup",Ee),o(e,"mouseup",Ee),ye=t.target}),o(x,"mouseup",function(n){var r=n.target;if(r&&r.nodeType==Node.ELEMENT_NODE&&r===ye&&u(r)&&l(x,r,!0)){var o=e.getSelection(),i=t.createRange();i.setStartBefore(r),i.setEndAfter(r),o.removeAllRanges(),o.addRange(i)}Ee(n),fe&&fe()}),o(x,"dblclick",function(e){Ee(e)}),o(x,"selectionchange",function(e){Ee(e)}),w&&o(x,"contextmenu",function(e){Ee(e,!0),a(e)});var Te=function(e,n,r){if(f(0,de),x.focus(),!m(x,r))return!1;try{return!(t.queryCommandSupported&&!t.queryCommandSupported(e))&&t.execCommand(e,!1,n)}catch(e){}return!1};if(o(x,"paste",function(e){var t=e.clipboardData;if(t){var n=t.items;if(n&&n.length){var r=n[0];if(r.type.match(/^image\//)){var o=new FileReader;o.onloadend=function(e){var t=e.target.result;t&&Te("insertImage",t)},o.readAsDataURL(r.getAsFile()),a(e)}}}}),F=function(e){fe&&fe(),e?(h(),de=null):de&&(de=c())},E={sync:function(){return ce&&ce(),this},getHTML:function(){return x.innerHTML},setHTML:function(e){return x.innerHTML=e||"",F(!0),this},getSelectedHTML:function(){return f(0,de),m(x)?g():null},collapseSelection:function(){return h(),de=null,this},expandSelection:function(e,t){return f(0,de),m(x)?(v(0,e,t),de=c(),this):this},openPopup:function(){return de||(de=c()),me()},activePopup:function(){return ve},closePopup:function(){return be(),this},removeFormat:function(){return Te("removeFormat"),Te("unlink"),F(),this},bold:function(){return Te("bold"),F(),this},italic:function(){return Te("italic"),F(),this},underline:function(){return Te("underline"),F(),this},strikethrough:function(){return Te("strikeThrough"),F(),this},forecolor:function(e){return Te("foreColor",e),F(),this},highlight:function(e){return Te("hiliteColor",e)||Te("backColor",e),F(),this},fontName:function(e){return Te("fontName",e),F(),this},fontSize:function(e){return Te("fontSize",e),F(),this},subscript:function(){return Te("subscript"),F(),this},superscript:function(){return Te("superscript"),F(),this},insertLink:function(e){return Te("createLink",e),F(!0),this},insertImage:function(e){return Te("insertImage",e,!0),F(!0),this},insertHTML:function(e){return Te("insertHTML",e,!0)||(f(0,de),m(x,!0),b(x,e)),F(!0),this}},T){var ke=t.createElement("div");if(A(ke,"toolbar"),H)A(ke,"toolbar-top"),R.insertBefore(ke,R.firstChild);else if(I)A(ke,"toolbar-bottom"),R.appendChild(ke);else{var Se=t.createElement("div");A(Se,"toolbar-auto"),R.appendChild(Se),Se.appendChild(ke)}j(ke,null,T,N)}return E}}(window,document);
