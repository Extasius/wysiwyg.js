!function(e,t,n){"use strict";var r=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var i=this,o=arguments;r=setTimeout(function(){r=null,e.apply(i,o)},t)}},i=function(e,t,n,r){e.addEventListener(t,n,!!r)},o=function(e,t,n,r){e.removeEventListener(t,n,!!r)},a=function(e){e.preventDefault(),e.stopPropagation()},l=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},u=function(t){var n=e.getSelection();return n.rangeCount>0?n.getRangeAt(0):null},c=function(t,n){if(n){var r=e.getSelection();r.removeAllRanges(),r.addRange(n)}},f=function(){var t=e.getSelection();if(!t.rangeCount)return!1;var n=t.getRangeAt(0).cloneRange(),r=n.getBoundingClientRect();if(r&&r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)};for(var i=n.getClientRects?n.getClientRects():[],o=0;o<i.length;++o){var r=i[o];if(r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)}}return!1},s=function(t){return!!e.getSelection().isCollapsed},p=function(n){var r=e.getSelection();if(!r.rangeCount)return[];for(var i=[],o=0;o<r.rangeCount;++o)for(var a=r.getRangeAt(o),u=a.startContainer,c=a.endContainer;u;){if(u!=n){var f=!1;if(r.containsNode)f=r.containsNode(u,!0);else{var s=t.createRange();s.selectNodeContents(u);for(var o=0;o<r.rangeCount;++o){var a=r.getRangeAt(o);if(a.compareBoundaryPoints(a.END_TO_START,s)>=0&&a.compareBoundaryPoints(a.START_TO_END,s)<=0){f=!0;break}}}f&&i.push(u)}u=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}(u,u==c?c:n)}return 0==i.length&&l(n,r.focusNode)&&r.focusNode!=n&&i.push(r.focusNode),i},d=function(){var t=e.getSelection();if(!t.isCollapsed)try{t.collapseToEnd()}catch(e){}},h=function(t,n,r){var i=e.getSelection();if(i.modify){for(var o=0;o<n;++o)i.modify("extend","backward","character");for(var o=0;o<r;++o)i.modify("extend","forward","character")}else{var a=i.getRangeAt(0);a.setStart(a.startContainer,a.startOffset-n),a.setEnd(a.endContainer,a.endOffset+r),i.removeAllRanges(),i.addRange(a)}},v=function(n){if(s())return null;var r=e.getSelection();if(r.rangeCount){for(var i=t.createElement("div"),o=r.rangeCount,a=0;a<o;++a){var l=r.getRangeAt(a).cloneContents();i.appendChild(l)}return i.innerHTML}return null},g=function(n,r){var i=e.getSelection();if(l(n,i.anchorNode)&&l(n,i.focusNode))return!0;if(!r)return!1;var o=t.createRange();return o.selectNodeContents(n),o.collapse(!1),i.removeAllRanges(),i.addRange(o),!0},m=function(n,r){var i=e.getSelection();if(i.getRangeAt&&i.rangeCount){var o=i.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var u,c,f=t.createDocumentFragment();u=a.firstChild;)c=f.appendChild(u);l(n,o.commonAncestorContainer)?(o.deleteContents(),o.insertNode(f)):n.appendChild(f),c&&(o=o.cloneRange(),o.setStartAfter(c),o.collapse(!0),i.removeAllRanges(),i.addRange(o))}},b=function(n,b,C,y,k,E,S,T,L){var w,M=null;if(b){!n.innerHTML&&b.value&&(n.innerHTML=b.value);var R=n.innerHTML,H=function(){var e=n.innerHTML;e.match(/^<br[\/ ]*>$/i)&&(n.innerHTML="",e=""),e!=R&&(b.value=e,R=e)};i(n,"focus",function(){var e=t.createEvent("Event");e.initEvent("focus",!1,!1),b.dispatchEvent(e)}),i(n,"blur",function(){H();var e=t.createEvent("Event");e.initEvent("blur",!1,!1),b.dispatchEvent(e)}),M=r(H,250,!0),i(n,"input",M),i(n,"propertychange",M),i(n,"textInput",M),i(n,"paste",M),i(n,"cut",M),i(n,"drop",M);new MutationObserver(M).observe(n,{attributes:!0,childList:!0,characterData:!0,subtree:!0});var N=b.form;N&&i(N,"reset",function(){n.innerHTML="",M(),w(!0)})}var I=null,A=null;if(E){A=r(function(e,t,r){var i=s(),o=p(n),a=null===e||null===t?null:{left:e,top:t,width:0,height:0},l=f();if(l&&(a=l),a){var u=n.getBoundingClientRect();a.left-=parseInt(u.left),a.top-=parseInt(u.top),a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>n.offsetWidth&&(a.width=n.offsetWidth),a.height>n.offsetHeight&&(a.height=n.offsetHeight)}else if(o.length)for(var c=0;c<o.length;++c){var d=o[c];if(d.nodeType==Node.ELEMENT_NODE){a={left:d.offsetLeft,top:d.offsetTop,width:d.offsetWidth,height:d.offsetHeight};break}}E(i,a,o,r)},1)}var P=null,x=function(e){var t=e.target||e.srcElement;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),l(P,t)||W()},D=function(){if(P)return P;i(e,"mousedown",x,!0),P=t.createElement("DIV");var r=n.parentNode,o=n.nextSibling;return o?r.insertBefore(P,o):r.appendChild(P),S&&S(),P},W=function(){P&&(P.parentNode.removeChild(P),P=null,o(e,"mousedown",x,!0),T&&T())},B=function(e,t){var n=e.which||e.keyCode,r=String.fromCharCode(n||e.charCode),i=e.shiftKey||!1,o=e.altKey||!1,l=e.ctrlKey||!1,u=e.metaKey||!1;if(1==t?C&&!1===C(n,r,i,o,l,u)&&a(e):2==t?y&&!1===y(n,r,i,o,l,u)&&a(e):3==t&&k&&!1===k(n,r,i,o,l,u)&&a(e),2==t&&(I=null),2!=t&&3!=t||A&&A(null,null,!1),2==t&&M)switch(n){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:M()}};i(n,"keydown",function(e){B(e,1)}),i(n,"keypress",function(e){B(e,2)}),i(n,"keyup",function(e){B(e,3)});var O=function(t,n){var r=null,i=null;t.clientX&&t.clientY?(r=t.clientX,i=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,i=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),o(e,"mouseup",O),I=null,!L&&n||A&&A(r,i,n)};i(n,"mousedown",function(t){o(e,"mouseup",O),i(e,"mouseup",O)}),i(n,"mouseup",function(e){O(e),M&&M()}),i(n,"dblclick",function(e){O(e)}),i(n,"selectionchange",function(e){O(e)}),L&&i(n,"contextmenu",function(e){O(e,!0),a(e)});var F=function(e,r,i){if(c(0,I),n.focus(),!g(n,i))return!1;try{return!(t.queryCommandSupported&&!t.queryCommandSupported(e))&&t.execCommand(e,!1,r)}catch(e){}return!1};return i(n,"paste",function(e){var t=e.clipboardData;if(t){var n=t.items;if(n&&n.length){var r=n[0];if(r.type.match(/^image\//)){var i=new FileReader;i.onloadend=function(e){var t=e.target.result;t&&F("insertImage",t)},i.readAsDataURL(r.getAsFile()),a(e)}}}}),w=function(e){M&&M(),e?(d(),I=null):I&&(I=u())},{sync:function(){return M&&M(),this},getHTML:function(){return n.innerHTML},setHTML:function(e){return n.innerHTML=e||"",w(!0),this},getSelectedHTML:function(){return c(0,I),g(n)?v():null},collapseSelection:function(){return d(),I=null,this},expandSelection:function(e,t){return c(0,I),g(n)?(h(0,e,t),I=u(),this):this},openPopup:function(){return I||(I=u()),D()},activePopup:function(){return P},closePopup:function(){return W(),this},removeFormat:function(){return F("removeFormat"),F("unlink"),w(),this},bold:function(){return F("bold"),w(),this},italic:function(){return F("italic"),w(),this},underline:function(){return F("underline"),w(),this},strikethrough:function(){return F("strikeThrough"),w(),this},forecolor:function(e){return F("foreColor",e),w(),this},highlight:function(e){return F("hiliteColor",e)||F("backColor",e),w(),this},fontName:function(e){return F("fontName",e),w(),this},fontSize:function(e){return F("fontSize",e),w(),this},subscript:function(){return F("subscript"),w(),this},superscript:function(){return F("superscript"),w(),this},insertLink:function(e){return F("createLink",e),w(!0),this},insertImage:function(e){return F("insertImage",e,!0),w(!0),this},insertHTML:function(e){return F("insertHTML",e,!0)||(c(0,I),g(n,!0),m(n,e)),w(!0),this}}};e.wysiwyg=function(n,o){var u,c=o.toolbar,f=o.buttons,s=o.selectionbuttons,p=o.suggester,d=o.interceptenter,h="string"==typeof n?t.querySelector(n):n,v=h.querySelector("textarea"),g={},m="top"==c,C="contentEditable"in t.body;if(C){var y=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);y&&420<=parseInt(y[1])&&parseInt(y[1])<534&&(C=!1)}if(!C)return null;var k=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},E=function(e,t){e.classList&&e.classList.remove(t)},S=h.querySelector("[contenteditable=true]");if(!S){S=t.createElement("div"),S.setAttribute("contentEditable","true");var T=v.placeholder;T&&S.setAttribute("placeholder",T),h.insertBefore(S,h.firstChild)}var L=null,w=function(){L&&clearTimeout(L),L=null,k(h,"focus")},M=function(){L||t.activeElement==S||(L=setTimeout(function(){L=null,E(h,"focus")},50))};i(S,"focus",w),i(S,"blur",M),v&&v.form&&i(v.form,"reset",M);var R=function(n,r){var o=t.createElement("input");o.placeholder="www.example.com",r&&(o.value=r.href),o.style.width="20em",o.style.maxWidth=parseInt(2*h.offsetWidth/3)+"px",o.autofocus=!0,r&&i(o,"input",function(e){var t=o.value.trim();t&&(r.href=t)}),i(o,"keypress",function(e){if(13==(e.which||e.keyCode)){var t=o.value.trim();if(r);else if(t){var n=t;if(/^[a-z0-9]+:\/\//.test(t)||(n="http://"+t),u.getSelectedHTML())u.insertLink(n);else{var i=function(e){return e.replace(/[&<>"]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e})};u.insertHTML('<a href="'+i(n)+'">'+i(t)+"</a>")}}u.closePopup().collapseSelection(),S.focus()}}),n.appendChild(o),e.setTimeout(function(){o.focus(),w()},1)},H=function(e,n){var r=t.createElement("table");r.style.borderCollapse="collapse";for(var o=1;o<15;++o){for(var a=t.createElement("tr"),l=0;l<25;++l){var c;if(24==l){var f=Math.floor(255/13*(14-o)).toString(16),s=(f.length<2?"0":"")+f;c="#"+s+s+s}else{var p=l/24,d=o<=8?o/8:1,h=o>8?(16-o)/8:1;c=function(e,t,n){var r,i,o,a,l,u,c,f;switch(a=Math.floor(6*e),l=6*e-a,u=n*(1-t),c=n*(1-l*t),f=n*(1-(1-l)*t),a%6){case 0:r=n,i=f,o=u;break;case 1:r=c,i=n,o=u;break;case 2:r=u,i=n,o=f;break;case 3:r=u,i=c,o=n;break;case 4:r=f,i=u,o=n;break;case 5:r=n,i=u,o=c}var s=Math.floor(255*r).toString(16),p=Math.floor(255*i).toString(16),d=Math.floor(255*o).toString(16);return"#"+(s.length<2?"0":"")+s+(p.length<2?"0":"")+p+(d.length<2?"0":"")+d}(p,d,h)}var v=t.createElement("td");v.style.width="0.5em",v.style.height="0.5em",v.style.cursor="pointer",v.style.backgroundColor=c,v.title=c,v.style.userSelect="none",i(v,"click",function(e){var t=this.title;n?u.forecolor(t).closePopup().collapseSelection():u.highlight(t).closePopup().collapseSelection()}),a.appendChild(v)}r.appendChild(a)}e.appendChild(r)},N=function(n,r,i){for(var o=h.offsetParent,a=0,l=0,u=!1,c=0,f=0,s=!1,p=!1;o;){c+=o.offsetLeft,f+=o.offsetTop;var d=getComputedStyle(o);"static"!=d.position?u=!0:u||(a+=o.offsetLeft,l+=o.offsetTop),"fixed"==d.position&&(s=!0),"visible"!=d.overflow&&(p=!0),o=o.offsetParent}var v=h.offsetParent||t.body;v.appendChild(n),r+=a+h.offsetLeft,i+=l+h.offsetTop;var g=n.offsetWidth;if(s||p){var m=v.offsetWidth;r+g>m-1&&(r=m-g-1),r<1&&(r=1)}var b=e.innerWidth,C=s?0:t.documentElement.scrollLeft;c+r+g>b+C-2&&(r=b+C-c-g-2),c+r<C+1&&(r=C-c+1),n.style.left=parseInt(r)+"px",n.style.top=parseInt(i)+"px"},I=function(){var e=u.openPopup();for(k(e,"wysiwyg-popup");e.firstChild;)e.removeChild(e.firstChild);return e},A=function(e,t,n){var r=I();t(r,n);var i=h.getBoundingClientRect(),o=e.getBoundingClientRect(),a=o.left-i.left+parseInt(e.offsetWidth/2)-parseInt(r.offsetWidth/2),l=o.top-i.top;m?l+=e.offsetHeight:l-=r.offsetHeight,N(r,a,l)},P=function(e,t){var n=h.getBoundingClientRect(),r=S.getBoundingClientRect(),i=t.left+parseInt(t.width/2)-parseInt(e.offsetWidth/2)+r.left-n.left,o=t.top+t.height+r.top-n.top;N(e,i,o)},x=function(e,t,n){var r=I();t(r,n),P(r,e)},D=null,W=null,B=function(e,n,r,o){r.forEach(function(r){if(r.html)if("string"==typeof r.html){var l=t.implementation.createHTMLDocument("");l.body.innerHTML=r.html;for(var c=l.body.firstChild;null!==c;c=c.nextSibling)e.appendChild(c)}else e.appendChild(r.html);else{var f=t.createElement("a");f.href="#",f.innerHTML=r.icon,r.title&&(f.title=r.title);var s=null;"click"in r?s=function(){r.click(u,f)}:"popup"in r?s=function(){var e=function(e){r.popup(u,e,f)};n?x(n,e):A(f,e)}:"insert"in r||"attach"in r?s=function(){u.closePopup().collapseSelection();var e=t.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",i(e,"change",function(t){var i="insert"in r;if(t.target.files)for(var o=n.target.files,l=0;l<o.length;++l)if("insert"in r){var c=new FileReader;c.onloadend=function(e){r.insert(u,e.target.result,f)},c.readAsDataURL(o[l])}else r.attach(u,e,o[l],f);else i=!0;i&&e.parentNode.removeChild(e),a(t)}),h.appendChild(e);var n=t.createEvent("MouseEvents");n.initEvent("click",!0,!1),e.dispatchEvent(n)}:"default"in r&&(s=function(){switch(r.default){case"link":n?x(n,R,W):A(f,R,W);break;case"bold":u.bold();break;case"italic":u.italic();break;case"underline":u.underline();break;case"strikethrough":u.strikethrough();break;case"forecolor":n?x(n,H,!0):A(f,H,!0);break;case"highlight":n?x(n,H,!1):A(f,H,!1);break;case"subscript":u.subscript();break;case"superscript":u.superscript();break;case"removeformat":u.removeFormat().closePopup().collapseSelection()}}),f.onclick=function(e){s&&s(),a(e)},e.appendChild(f),"hotkey"in r&&s&&o&&(o[r.hotkey.toLowerCase()]=s)}})},O=null,F=1,q=null,X=function(e){e&&u.expandSelection(O.length,0).insertHTML(e),O=null,q=null,F+=1,u.closePopup()},_=function(e,t,n,r,i,o){return 13!=e||!q||(X(q),!1)},K=function(){if(O){var e=F;p(O,function(n){if(D&&e==F){if(q=null,!n)return void X();x(D,function(e){n.forEach(function(n){var r=t.createElement("div");k(r,"suggestion"),r.innerHTML=n.label,r.style.cursor="pointer",i(r,"click",function(e){X(n.insert),a(e)}),e.appendChild(r),null===q&&(q=n.insert)})})}})||X()}},Y=r(K,100,!0),z=function(e,t,n,r,i,o){switch(e){case 8:if(O&&(O=O.slice(0,-1)),O)break;case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return X(),!0;default:O||(O=""),O+=t}return Y(),!0};if(u=b(S,v,function(e,t,n,r,i,o){if(p)return _(e);if(d&&13==e&&!n&&!r&&!i&&!o&&(u.sync().closePopup(),d()))return!1;if(t&&!n&&!r&&i&&!o){var a=t.toLowerCase();if(!g[a])return;return g[a](),!1}},function(e,t,n,r,i,o){if(p)return z(e,t)},function(e,t,n,r,i,o){},function(e,n,r,i){if(D=e?n||D:null,W=null,!n)return void X();if(e){if(null!==O){var o=u.activePopup();return void(o&&P(o,n))}}else X();for(var a=0;a<r.length;++a){var c=r[a],f=c.closest||function(e){for(var t=this;t;){var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;if(n&&n.call(t,e))return t;t=t.parentElement}return null};if(W=f.call(c,"a"))break}var p=!0;if(i);else if(s)if(e)p=!1;else{var d=[];if(r.forEach(function(e){"IMG"==e.nodeName&&d.push(e)}),1==d.length){var h=!0,v=d.shift();r.forEach(function(e){l(e,v)||(h=!1)}),h&&(p=!1)}}else p=!1;if(!p)return void X();x(n,function(e){var r=t.createElement("div");k(r,"toolbar"),e.appendChild(r),B(r,n,s)})},function(){w()},function(){X(),M()},!0),f){var U=t.createElement("div");k(U,"toolbar"),m?(k(U,"toolbar-top"),h.insertBefore(U,h.firstChild)):(k(U,"bottom"==c?"toolbar-bottom":"toolbar-auto"),h.appendChild(U)),B(U,null,f,g)}return u}}(window,document);
