!function(e,t,n){"use strict";var r=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var i=this,o=arguments;r=setTimeout(function(){r=null,e.apply(i,o)},t)}},i=function(e,t,n,r){e.addEventListener(t,n,!!r)},o=function(e,t,n,r){e.removeEventListener(t,n,!!r)},a=function(e){e.preventDefault(),e.stopPropagation()},l=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(t){var n=e.getSelection();return n.rangeCount>0?n.getRangeAt(0):null},u=function(t,n){if(n){var r=e.getSelection();r.removeAllRanges(),r.addRange(n)}},f=function(){var t=e.getSelection();if(!t.rangeCount)return!1;var n=t.getRangeAt(0).cloneRange(),r=n.getBoundingClientRect();if(r&&r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)};for(var i=n.getClientRects?n.getClientRects():[],o=0;o<i.length;++o){var r=i[o];if(r.left&&r.top&&r.right&&r.bottom)return{left:parseInt(r.left),top:parseInt(r.top),width:parseInt(r.right-r.left),height:parseInt(r.bottom-r.top)}}return!1},s=function(t){return!!e.getSelection().isCollapsed},p=function(n){var r=e.getSelection();if(!r.rangeCount)return[];for(var i=[],o=0;o<r.rangeCount;++o)for(var a=r.getRangeAt(o),c=a.startContainer,u=a.endContainer;c;){if(c!=n){var f=!1;if(r.containsNode)f=r.containsNode(c,!0);else{var s=t.createRange();s.selectNodeContents(c);for(var o=0;o<r.rangeCount;++o){var a=r.getRangeAt(o);if(a.compareBoundaryPoints(a.END_TO_START,s)>=0&&a.compareBoundaryPoints(a.START_TO_END,s)<=0){f=!0;break}}}f&&i.push(c)}c=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}(c,c==u?u:n)}return 0==i.length&&l(n,r.focusNode)&&r.focusNode!=n&&i.push(r.focusNode),i},d=function(){var t=e.getSelection();if(!t.isCollapsed)try{t.collapseToEnd()}catch(e){}},h=function(t,n,r){var i=e.getSelection();if(i.modify){for(var o=0;o<n;++o)i.modify("extend","backward","character");for(var o=0;o<r;++o)i.modify("extend","forward","character")}else{var a=i.getRangeAt(0);a.setStart(a.startContainer,a.startOffset-n),a.setEnd(a.endContainer,a.endOffset+r),i.removeAllRanges(),i.addRange(a)}},v=function(n){if(s())return null;var r=e.getSelection();if(r.rangeCount){for(var i=t.createElement("div"),o=r.rangeCount,a=0;a<o;++a){var l=r.getRangeAt(a).cloneContents();i.appendChild(l)}return i.innerHTML}return null},g=function(n,r){var i=e.getSelection();if(l(n,i.anchorNode)&&l(n,i.focusNode))return!0;if(!r)return!1;var o=t.createRange();return o.selectNodeContents(n),o.collapse(!1),i.removeAllRanges(),i.addRange(o),!0},m=function(n,r){var i=e.getSelection();if(i.getRangeAt&&i.rangeCount){var o=i.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var c,u,f=t.createDocumentFragment();c=a.firstChild;)u=f.appendChild(c);l(n,o.commonAncestorContainer)?(o.deleteContents(),o.insertNode(f)):n.appendChild(f),u&&(o=o.cloneRange(),o.setStartAfter(u),o.collapse(!0),i.removeAllRanges(),i.addRange(o))}},b=function(n,b,C,y,k,E,S,T,L){var w,M=null;if(b){!n.innerHTML&&b.value&&(n.innerHTML=b.value);var R=n.innerHTML,H=function(){var e=n.innerHTML;e.match(/^<br[\/ ]*>$/i)&&(n.innerHTML="",e=""),e!=R&&(b.value=e,R=e)};i(n,"focus",function(){var e=t.createEvent("Event");e.initEvent("focus",!1,!1),b.dispatchEvent(e)}),i(n,"blur",function(){H();var e=t.createEvent("Event");e.initEvent("blur",!1,!1),b.dispatchEvent(e)}),M=r(H,250,!0),i(n,"input",M),i(n,"propertychange",M),i(n,"textInput",M),i(n,"paste",M),i(n,"cut",M),i(n,"drop",M);new MutationObserver(M).observe(n,{attributes:!0,childList:!0,characterData:!0,subtree:!0});var N=b.form;N&&i(N,"reset",function(){n.innerHTML="",M(),w(!0)})}var I=null,A=null;if(E){A=r(function(e,t,r){var i=s(),o=p(n),a=null===e||null===t?null:{left:e,top:t,width:0,height:0},l=f();if(l&&(a=l),a){var c=n.getBoundingClientRect();a.left-=parseInt(c.left),a.top-=parseInt(c.top),a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>n.offsetWidth&&(a.width=n.offsetWidth),a.height>n.offsetHeight&&(a.height=n.offsetHeight)}else if(o.length)for(var u=0;u<o.length;++u){var d=o[u];if(d.nodeType==Node.ELEMENT_NODE){a={left:d.offsetLeft,top:d.offsetTop,width:d.offsetWidth,height:d.offsetHeight};break}}E(i,a,o,r)},1)}var P=null,x=function(e){var t=e.target||e.srcElement;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),l(P,t)||W()},D=function(){if(P)return P;i(e,"mousedown",x,!0),P=t.createElement("DIV");var r=n.parentNode,o=n.nextSibling;return o?r.insertBefore(P,o):r.appendChild(P),S&&S(),P},W=function(){P&&(P.parentNode.removeChild(P),P=null,o(e,"mousedown",x,!0),T&&T())},B=function(e,t){var n=e.which||e.keyCode,r=String.fromCharCode(n||e.charCode),i=e.shiftKey||!1,o=e.altKey||!1,l=e.ctrlKey||!1,c=e.metaKey||!1;if(1==t?C&&!1===C(n,r,i,o,l,c)&&a(e):2==t?y&&!1===y(n,r,i,o,l,c)&&a(e):3==t&&k&&!1===k(n,r,i,o,l,c)&&a(e),2==t&&(I=null),2!=t&&3!=t||A&&A(null,null,!1),2==t&&M)switch(n){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:M()}};i(n,"keydown",function(e){B(e,1)}),i(n,"keypress",function(e){B(e,2)}),i(n,"keyup",function(e){B(e,3)});var O=function(t,n){var r=null,i=null;t.clientX&&t.clientY?(r=t.clientX,i=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,i=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),o(e,"mouseup",O),I=null,!L&&n||A&&A(r,i,n)};i(n,"mousedown",function(t){o(e,"mouseup",O),i(e,"mouseup",O)}),i(n,"mouseup",function(e){O(e),M&&M()}),i(n,"dblclick",function(e){O(e)}),i(n,"selectionchange",function(e){O(e)}),L&&i(n,"contextmenu",function(e){O(e,!0),a(e)});var F=function(e,r,i){if(u(0,I),n.focus(),!g(n,i))return!1;try{return!(t.queryCommandSupported&&!t.queryCommandSupported(e))&&t.execCommand(e,!1,r)}catch(e){}return!1};return i(n,"paste",function(e){var t=e.clipboardData;if(t){var n=t.items;if(n&&n.length){var r=n[0];if(r.type.match(/^image\//)){var i=new FileReader;i.onloadend=function(e){var t=e.target.result;t&&F("insertImage",t)},i.readAsDataURL(r.getAsFile()),a(e)}}}}),w=function(e){M&&M(),e?(d(),I=null):I&&(I=c())},{sync:function(){return M&&M(),this},getHTML:function(){return n.innerHTML},setHTML:function(e){return n.innerHTML=e||"",w(!0),this},getSelectedHTML:function(){return u(0,I),g(n)?v():null},collapseSelection:function(){return d(),I=null,this},expandSelection:function(e,t){return u(0,I),g(n)?(h(0,e,t),I=c(),this):this},openPopup:function(){return I||(I=c()),D()},activePopup:function(){return P},closePopup:function(){return W(),this},removeFormat:function(){return F("removeFormat"),F("unlink"),w(),this},bold:function(){return F("bold"),w(),this},italic:function(){return F("italic"),w(),this},underline:function(){return F("underline"),w(),this},strikethrough:function(){return F("strikeThrough"),w(),this},forecolor:function(e){return F("foreColor",e),w(),this},highlight:function(e){return F("hiliteColor",e)||F("backColor",e),w(),this},fontName:function(e){return F("fontName",e),w(),this},fontSize:function(e){return F("fontSize",e),w(),this},subscript:function(){return F("subscript"),w(),this},superscript:function(){return F("superscript"),w(),this},insertLink:function(e){return F("createLink",e),w(!0),this},insertImage:function(e){return F("insertImage",e,!0),w(!0),this},insertHTML:function(e){return F("insertHTML",e,!0)||(u(0,I),g(n,!0),m(n,e)),w(!0),this}}};e.wysiwyg=function(n,o,c,u,f,s){var p,d="string"==typeof n?t.querySelector(n):n,h=d.querySelector("textarea"),v={},g="top"==o,m="contentEditable"in t.body;if(m){var C=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);C&&420<=parseInt(C[1])&&parseInt(C[1])<534&&(m=!1)}if(!m)return null;var y=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},k=function(e,t){e.classList&&e.classList.remove(t)},E=d.querySelector("[contenteditable=true]");if(!E){E=t.createElement("div"),E.setAttribute("contentEditable","true");var S=h.placeholder;S&&E.setAttribute("placeholder",S),d.insertBefore(E,d.firstChild)}var T=null,L=function(){T&&clearTimeout(T),T=null,y(d,"focus")},w=function(){T||t.activeElement==E||(T=setTimeout(function(){T=null,k(d,"focus")},50))};i(E,"focus",L),i(E,"blur",w),h&&h.form&&i(h.form,"reset",w);var M=function(n,r){var o=t.createElement("input");o.placeholder="www.example.com",r&&(o.value=r.href),o.style.width="20em",o.style.maxWidth=parseInt(2*d.offsetWidth/3)+"px",o.autofocus=!0,r&&i(o,"input",function(e){var t=o.value.trim();t&&(r.href=t)}),i(o,"keypress",function(e){if(13==(e.which||e.keyCode)){var t=o.value.trim();if(r);else if(t){var n=t;if(/^[a-z0-9]+:\/\//.test(t)||(n="http://"+t),p.getSelectedHTML())p.insertLink(n);else{var i=function(e){return e.replace(/[&<>"]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e})};p.insertHTML('<a href="'+i(n)+'">'+i(t)+"</a>")}}p.closePopup().collapseSelection(),E.focus()}}),n.appendChild(o),e.setTimeout(function(){o.focus(),L()},1)},R=function(e,n){var r=t.createElement("table");r.style.borderCollapse="collapse";for(var o=1;o<15;++o){for(var a=t.createElement("tr"),l=0;l<25;++l){var c;if(24==l){var u=Math.floor(255/13*(14-o)).toString(16),f=(u.length<2?"0":"")+u;c="#"+f+f+f}else{var s=l/24,d=o<=8?o/8:1,h=o>8?(16-o)/8:1;c=function(e,t,n){var r,i,o,a,l,c,u,f;switch(a=Math.floor(6*e),l=6*e-a,c=n*(1-t),u=n*(1-l*t),f=n*(1-(1-l)*t),a%6){case 0:r=n,i=f,o=c;break;case 1:r=u,i=n,o=c;break;case 2:r=c,i=n,o=f;break;case 3:r=c,i=u,o=n;break;case 4:r=f,i=c,o=n;break;case 5:r=n,i=c,o=u}var s=Math.floor(255*r).toString(16),p=Math.floor(255*i).toString(16),d=Math.floor(255*o).toString(16);return"#"+(s.length<2?"0":"")+s+(p.length<2?"0":"")+p+(d.length<2?"0":"")+d}(s,d,h)}var v=t.createElement("td");v.style.width="0.5em",v.style.height="0.5em",v.style.cursor="pointer",v.style.backgroundColor=c,v.title=c,v.style.userSelect="none",i(v,"click",function(e){var t=this.title;n?p.forecolor(t).closePopup().collapseSelection():p.highlight(t).closePopup().collapseSelection()}),a.appendChild(v)}r.appendChild(a)}e.appendChild(r)},H=function(n,r,i){for(var o=d.offsetParent,a=0,l=0,c=!1,u=0,f=0,s=!1,p=!1;o;){u+=o.offsetLeft,f+=o.offsetTop;var h=getComputedStyle(o);"static"!=h.position?c=!0:c||(a+=o.offsetLeft,l+=o.offsetTop),"fixed"==h.position&&(s=!0),"visible"!=h.overflow&&(p=!0),o=o.offsetParent}var v=d.offsetParent||t.body;v.appendChild(n),r+=a+d.offsetLeft,i+=l+d.offsetTop;var g=n.offsetWidth;if(s||p){var m=v.offsetWidth;r+g>m-1&&(r=m-g-1),r<1&&(r=1)}var b=e.innerWidth,C=s?0:t.documentElement.scrollLeft;u+r+g>b+C-2&&(r=b+C-u-g-2),u+r<C+1&&(r=C-u+1),n.style.left=parseInt(r)+"px",n.style.top=parseInt(i)+"px"},N=function(){var e=p.openPopup();for(y(e,"wysiwyg-popup");e.firstChild;)e.removeChild(e.firstChild);return e},I=function(e,t,n){var r=N();t(r,n);var i=d.getBoundingClientRect(),o=e.getBoundingClientRect(),a=o.left-i.left+parseInt(e.offsetWidth/2)-parseInt(r.offsetWidth/2),l=o.top-i.top;g?l+=e.offsetHeight:l-=r.offsetHeight,H(r,a,l)},A=function(e,t){var n=d.getBoundingClientRect(),r=E.getBoundingClientRect(),i=t.left+parseInt(t.width/2)-parseInt(e.offsetWidth/2)+r.left-n.left,o=t.top+t.height+r.top-n.top;H(e,i,o)},P=function(e,t,n){var r=N();t(r,n),A(r,e)},x=null,D=null,W=function(e,n,r,o){r.forEach(function(r){if(r.html)if("string"==typeof r.html){var l=t.implementation.createHTMLDocument("");l.body.innerHTML=r.html;for(var c=l.body.firstChild;null!==c;c=c.nextSibling)e.appendChild(c)}else e.appendChild(r.html);else{var u=t.createElement("a");u.href="#",u.innerHTML=r.icon,r.title&&(u.title=r.title);var f=null;"click"in r?f=function(){r.click(p,u)}:"popup"in r?f=function(){var e=function(e){r.popup(p,e,u)};n?P(n,e):I(u,e)}:"insert"in r||"attach"in r?f=function(){p.closePopup().collapseSelection();var e=t.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",i(e,"change",function(t){var i="insert"in r;if(t.target.files)for(var o=n.target.files,l=0;l<o.length;++l)if("insert"in r){var c=new FileReader;c.onloadend=function(e){r.insert(p,e.target.result,u)},c.readAsDataURL(o[l])}else r.attach(p,e,o[l],u);else i=!0;i&&e.parentNode.removeChild(e),a(t)}),d.appendChild(e);var n=t.createEvent("MouseEvents");n.initEvent("click",!0,!1),e.dispatchEvent(n)}:"default"in r&&(f=function(){switch(r.default){case"link":n?P(n,M,D):I(u,M,D);break;case"bold":p.bold();break;case"italic":p.italic();break;case"underline":p.underline();break;case"strikethrough":p.strikethrough();break;case"forecolor":n?P(n,R,!0):I(u,R,!0);break;case"highlight":n?P(n,R,!1):I(u,R,!1);break;case"subscript":p.subscript();break;case"superscript":p.superscript();break;case"removeformat":p.removeFormat().closePopup().collapseSelection()}}),u.onclick=function(e){f&&f(),a(e)},e.appendChild(u),"hotkey"in r&&f&&o&&(o[r.hotkey.toLowerCase()]=f)}})},B=null,O=1,F=null,q=function(e){e&&p.expandSelection(B.length,0).insertHTML(e),B=null,F=null,O+=1,p.closePopup()},X=function(e,t,n,r,i,o){return 13!=e||!F||(q(F),!1)},_=function(){if(B){var e=O;f(B,function(n){if(x&&e==O){if(F=null,!n)return void q();P(x,function(e){n.forEach(function(n){var r=t.createElement("div");y(r,"suggestion"),r.innerHTML=n.label,r.style.cursor="pointer",i(r,"click",function(e){q(n.insert),a(e)}),e.appendChild(r),null===F&&(F=n.insert)})})}})||q()}},K=r(_,100,!0),Y=function(e,t,n,r,i,o){switch(e){case 8:if(B&&(B=B.slice(0,-1)),B)break;case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return q(),!0;default:B||(B=""),B+=t}return K(),!0};if(p=b(E,h,function(e,t,n,r,i,o){if(f)return X(e);if(s&&13==e&&!n&&!r&&!i&&!o&&(p.sync().closePopup(),s()))return!1;if(t&&!n&&!r&&i&&!o){var a=t.toLowerCase();if(!v[a])return;return v[a](),!1}},function(e,t,n,r,i,o){if(f)return Y(e,t)},function(e,t,n,r,i,o){},function(e,n,r,i){if(x=e?n||x:null,D=null,!n)return void p.closePopup();if(e&&null!==B){var o=p.activePopup();return void(o&&A(o,n))}for(var a=0;a<r.length;++a){var c=r[a],f=c.closest||function(e){for(var t=this;t;){var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;if(n&&n.call(t,e))return t;t=t.parentElement}return null};if(D=f.call(c,"a"))break}var s=!0;if(i);else if(u)if(e)s=!1;else{var d=[];if(r.forEach(function(e){"IMG"==e.nodeName&&d.push(e)}),1==d.length){var h=!0,v=d.shift();r.forEach(function(e){l(e,v)||(h=!1)}),h&&(s=!1)}}else s=!1;if(!s)return void p.closePopup();P(n,function(e){var r=t.createElement("div");y(r,"toolbar"),e.appendChild(r),W(r,n,u)})},function(){L()},function(){q(),w()},!0),c){var z=t.createElement("div");y(z,"toolbar"),g?(y(z,"toolbar-top"),d.insertBefore(z,d.firstChild)):(y(z,"bottom"==o?"toolbar-bottom":"toolbar-auto"),d.appendChild(z)),W(z,null,c,v)}return p}}(window,document);
